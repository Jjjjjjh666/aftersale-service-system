## 售后模块类图描述

### 一、核心领域模型类（Model层）

#### 1. AftersaleOrder（售后单）

属性：

- id: 售后单ID

- shopId: 商户ID

- orderId: 订单ID

- customerId: 客户ID

- productId: 产品ID

- type: 售后类型

- status: 售后状态

- reason: 售后原因

- conclusion: 审核结论

- expressId: 客户寄回商品的运单ID

- returnExpressId: 商家发货的运单ID

- createdAt: 创建时间

- updatedAt: 更新时间

方法：

- fromPo(in po)

- toPo()

- convertStatus(in statusCode)

- convertStatusToInt(in status)

- checkPendingStatus()

- checkCanCancel()

- approveToBeReceived(in conclusion)

- approveToBeCompleted(in conclusion)

- cancel()

- reject(in conclusion)

- getAftersaleType()

- checkCanReceive()

- complete(in conclusion)

#### 2. AftersaleStatus（枚举类）

枚举值：

- PENDING: 待审核

- TO_BE_RECEIVED: 待验收

- TO_BE_COMPLETED: 待完成

- REJECTED: 已拒绝

- COMPLETED: 已完成

- CANCELLED: 已取消

属性：

- code: 状态码

- description: 描述

方法：

- of(in code)

- isTerminal()

- canCancel()

#### 3. AftersaleType（枚举类）

枚举值：

- EXCHANGE: 换货

- RETURN: 退货

- REPAIR: 维修

属性：

- code: 类型码

- description: 描述

方法：

- valueOf(in code)

---

### 二、策略模式相关类（Strategy层）

#### 4. AftersaleConfirmStrategy（接口）

方法：

- confirm(in order, in confirm, in conclusion)

- support(in type)

#### 5. ExchangeConfirmStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- confirm(in order, in confirm, in conclusion)

- support(in type)

- createExchangePackage(in order)

#### 6. ReturnConfirmStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- confirm(in order, in confirm, in conclusion)

- support(in type)

- createReturnPackage(in order)

#### 7. RepairConfirmStrategy（实现类）

依赖：

- serviceClient: ServiceClient

方法：

- confirm(in order, in confirm, in conclusion)

- support(in type)

#### 8. AftersaleCancelStrategy（接口）

方法：

- cancel(in order, in reason)

- support(in type)

#### 9. ExchangeCancelStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- cancel(in order, in reason)

- support(in type)

#### 10. ReturnCancelStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- cancel(in order, in reason)

- support(in type)

#### 11. RepairCancelStrategy（实现类）

依赖：

- serviceClient: ServiceClient

方法：

- cancel(in order, in reason)

- support(in type)

#### 12. AftersaleReceiveStrategy（接口）

方法：

- receive(in order, in accept, in conclusion)

- support(in type)

#### 13. ExchangeReceiveStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- receive(in order, in accept, in conclusion)

- support(in type)

- createOutboundPackage(in order)

- createReturnPackage(in order)

#### 14. ReturnReceiveStrategy（实现类）

依赖：

- logisticsClient: LogisticsClient

方法：

- receive(in order, in accept, in conclusion)

- support(in type)

- createReturnPackage(in order)

---

### 三、持久化对象类（PO层）

#### 15. AftersaleOrderPo

属性：

- id: 售后单ID

- shopId: 商户ID

- orderId: 订单ID

- orderItemId: 订单项ID

- customerId: 客户ID

- productId: 产品ID

- type: 售后类型

- reason: 售后原因

- status: 售后状态

- conclusion: 审核结论

- expressId: 客户寄回商品的运单ID

- returnExpressId: 商家发货的运单ID

- gmtCreate: 创建时间

- gmtModified: 修改时间

---

### 四、仓储类（Repository层）

#### 16. AftersaleOrderRepository

依赖：

- mapper: AftersaleOrderMapper

方法：

- findById(in shopId, in id)

- save(in order)

- create(in order)

---

### 五、服务类（Service层）

#### 17. AftersaleService

依赖：

- repository: AftersaleOrderRepository

- confirmStrategies: List<AftersaleConfirmStrategy>

- cancelStrategies: List<AftersaleCancelStrategy>

- receiveStrategies: List<AftersaleReceiveStrategy>

方法：

- confirmAftersale(in shopId, in id, in confirm, in conclusion)

- receiveAftersale(in shopId, in id, in accept, in conclusion)

- cancelAftersale(in shopId, in id, in reason)

---

### 六、外部客户端（Client层）

#### 18. LogisticsClient（接口）

方法：

- createPackage(in shopId, in authorization, in request)

- cancelPackage(in shopId, in id, in authorization)

#### 19. ServiceClient（接口）

方法：

- createServiceOrder(in shopId, in aftersalesId, in request)

- cancelServiceOrder(in shopId, in aftersalesId, in reason)

---

### 七、类与类之间的关联关系

#### 一、关联关系（实线有箭头）

1. AftersaleOrder ──→ AftersaleStatus

- 成员变量：private AftersaleStatus status;

1. ExchangeConfirmStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

1. ReturnConfirmStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

1. RepairConfirmStrategy ──→ ServiceClient

- 成员变量：private final ServiceClient serviceClient;

1. ExchangeCancelStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

1. ReturnCancelStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

1. RepairCancelStrategy ──→ ServiceClient

- 成员变量：private final ServiceClient serviceClient;

1. ExchangeReceiveStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

1. ReturnReceiveStrategy ──→ LogisticsClient

- 成员变量：private final LogisticsClient logisticsClient;

---

#### 二、关联关系（实线无箭头）

1. AftersaleOrderRepository ── AftersaleOrder

---

#### 三、依赖关系（虚线箭头）

##### 依赖注入的服务：

1. AftersaleOrderRepository ‐ ‐ → AftersaleOrderMapper

2. AftersaleService ‐ ‐ → AftersaleOrderRepository

3. AftersaleService ‐ ‐ → AftersaleConfirmStrategy

4. AftersaleService ‐ ‐ → AftersaleCancelStrategy

5. AftersaleService ‐ ‐ → AftersaleReceiveStrategy

##### 方法参数/返回值/局部变量：

1. AftersaleOrder ‐ ‐ → AftersaleOrderPo

2. AftersaleOrder ‐ ‐ → AftersaleType

3. AftersaleConfirmStrategy ‐ ‐ → AftersaleOrder

4. ExchangeConfirmStrategy ‐ ‐ → AftersaleOrder

5. ExchangeConfirmStrategy ‐ ‐ → AftersaleType

6. ReturnConfirmStrategy ‐ ‐ → AftersaleOrder

7. ReturnConfirmStrategy ‐ ‐ → AftersaleType

8. RepairConfirmStrategy ‐ ‐ → AftersaleOrder

9. RepairConfirmStrategy ‐ ‐ → AftersaleType

10. AftersaleCancelStrategy ‐ ‐ → AftersaleOrder

11. ExchangeCancelStrategy ‐ ‐ → AftersaleOrder

12. ExchangeCancelStrategy ‐ ‐ → AftersaleType

13. ReturnCancelStrategy ‐ ‐ → AftersaleOrder

14. ReturnCancelStrategy ‐ ‐ → AftersaleType

15. RepairCancelStrategy ‐ ‐ → AftersaleOrder

16. RepairCancelStrategy ‐ ‐ → AftersaleType

17. AftersaleReceiveStrategy ‐ ‐ → AftersaleOrder

18. ExchangeReceiveStrategy ‐ ‐ → AftersaleOrder

19. ExchangeReceiveStrategy ‐ ‐ → AftersaleType

20. ReturnReceiveStrategy ‐ ‐ → AftersaleOrder

21. ReturnReceiveStrategy ‐ ‐ → AftersaleType

22. AftersaleOrderRepository ‐ ‐ → AftersaleOrderPo

23. AftersaleService ‐ ‐ → AftersaleOrder

---

#### 四、实现关系（空心三角形+虚线）

1. ExchangeConfirmStrategy ─ ─ ▷ AftersaleConfirmStrategy

2. ReturnConfirmStrategy ─ ─ ▷ AftersaleConfirmStrategy

3. RepairConfirmStrategy ─ ─ ▷ AftersaleConfirmStrategy

4. ExchangeCancelStrategy ─ ─ ▷ AftersaleCancelStrategy

5. ReturnCancelStrategy ─ ─ ▷ AftersaleCancelStrategy

6. RepairCancelStrategy ─ ─ ▷ AftersaleCancelStrategy

7. ExchangeReceiveStrategy ─ ─ ▷ AftersaleReceiveStrategy

8. ReturnReceiveStrategy ─ ─ ▷ AftersaleReceiveStrategy

---

## 关系总结

- 关联（实线有箭头）：9条

- 关联（实线无箭头）：1条

- 依赖（虚线箭头）：28条

- 实现（空心三角+虚线）：8条

合计：46条关系

---

设计模式：策略模式

- 审核策略：3个实现（换货、退货、维修）

- 取消策略：3个实现（换货、退货、维修）

- 验收策略：2个实现（换货、退货，维修无需验收）

完成！✅